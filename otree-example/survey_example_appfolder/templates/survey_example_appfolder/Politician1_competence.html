{% extends "global/Page.html" %}
{% load otree static %}


{% block title %}
<h2> Befragung zur Wahrnehmung von Politikerinnen </h2>
    <hr>
{% endblock %}

{% block content %}
<br>
    <b>Bitte schauen Sie sich diese Person für mindestens 3 Sekunden genau an und beantworten Sie dann die Fragen.</b>

    <!-- create an image path variable-->

    <script>
        //fetch player group
        var playerGroup = {{ player_group }};
        console.log(playerGroup);
        
        //import dict from the constants (we have to change this part as soon as we now how all the pictres are actually named)
        //var groupPictures = {{Constants.groupPictures}};
        //console.log(groupPictures);
    
        //select a random image from using the group of the player
        var availablePictures = {{ available_pictures | safe }};
        var randomNum = Math.floor(Math.random() * availablePictures.length);
        var displayedPicture = availablePictures[randomNum];
        console.log(displayedPicture);
    
        //construct path to the image 
        var imagePath = "/static/Group_" + playerGroup + "/" + "P_" + displayedPicture + ".jpg";
        console.log(imagePath);
        
        //picture_assignment = displayedPicture;
    </script>

    <!-- Hidden input field for the picture assignment --> 
    <input id="picture_assignment" type="hidden" name="{{ picture_field }}" value="{{ current_picture }}"/>

    <script>
        // Set the hidden input value with the selected picture
        document.querySelector('input[name="{{ picture_field }}"]').value = displayedPicture;
        console.log("Updating hidden input for picture assignment:", displayedPicture);
    </script>


    <!-- Create empty image container -->
    <img id="politician" width="50%" height="50%" src="" />
    
    <script>
        //insert the constructed path 
        document.getElementById("politician").src = imagePath;
    </script>
    <br>
    <br>
    <br>

<!-- Hidden popout question initially -->
    <div id="popout-question" style="display: none;">
        <br>
        <p><b>Wie schätzen Sie die Kompetenz dieser Politikerin ein?</b></p>

        <!-- Form for the answer choices -->
        <form method="post">

            <table style="border-collapse: collapse; text-align: center; width: 60%; table-layout: fixed;">
                <thead>
                    <tr>
                        <th style="width: 20%;"></th>
                        <th style="padding: 10px; font-size: 16px;">1</th>
                        <th style="padding: 10px; font-size: 16px;">2</th>
                        <th style="padding: 10px; font-size: 16px;">3</th>
                        <th style="padding: 10px; font-size: 16px;">4</th>
                        <th style="padding: 10px; font-size: 16px;">5</th>
                        <th style="width: 20%;"></th>
                        <th style="padding: 10px; font-size: 16px;">Keine Eingabe</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="text-align: right;">Überhaupt nicht kompetent</td>
                        <td><input type="radio" name="{{ field_name }}" value="1" {% if field_value == 1 %} checked {% endif %}></td>
                        <td><input type="radio" name="{{ field_name }}" value="2" {% if field_value == 2 %} checked {% endif %}></td>
                        <td><input type="radio" name="{{ field_name }}" value="3" {% if field_value == 3 %} checked {% endif %}></td>
                        <td><input type="radio" name="{{ field_name }}" value="4" {% if field_value == 4 %} checked {% endif %}></td>
                        <td><input type="radio" name="{{ field_name }}" value="5" {% if field_value == 5 %} checked {% endif %}></td>
                        <td style="text-align: left;">Sehr kompetent</td>
                        <td><input type="radio" name="{{ field_name }}" value="-1" {% if field_value == -1 %} checked {% endif %}></td>
                    </tr>
                </tbody>
            </table>

            <div class="form-errors">
                {{ formfield_errors field_name }}
            </div>

            <button class="otree-btn-next btn btn-primary">Weiter</button>
        </form>
    </div>

    <!-- Add JavaScript to show the popout after 3 seconds -->
    <script>
        setTimeout(function() {
            // Show the popout question after 3 seconds
            document.getElementById("popout-question").style.display = "block";
        }, 3000);  // 3000 milliseconds = 3 seconds
    </script>
{% endblock %}